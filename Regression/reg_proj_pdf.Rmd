---
title: "Does Choice of Transmission Affect MPG?"
output: html_document
---

```{r, echo=FALSE}
# some useful functions for figures
panel.hist <- function(x, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(usr[1:2], 0, 1.5) )
    h <- hist(x, plot = FALSE)
    breaks <- h$breaks; nB <- length(breaks)
    y <- h$counts; y <- y/max(y)
    rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}

# Prepare data
library(datasets)
cars <- mtcars
cars$am <- factor(mtcars$am, labels=c("Automatic", "Manual"))
cars$vs <- factor(mtcars$vs)
cars$qear <- factor(mtcars$gear)
cars$carb <- factor(mtcars$carb)
```
## Executive Summary
In this analysis we explore the mtcars dataset that comes with R to explore the relationship between the variables and miles per gallon (mpg). In particular, we seek to address the following questions:

- Is an automatic or manual transmission better for MPG
- Quantify the MPG difference between automatic and manual transmissions

For those with little time the quick take away is that our analysis showed  

- Having a manual transmission will ...
- Observation 2...

## Exploratory Data Analysis
In this section we will explore various relationship among the variables in the data.
Since we are interested in the effects of transmission type on `mpg`  we create a boxbplot of `mpg` when the transmission is `Automatic` and when it is ```Manual```, **figure 1**. The plot shows an increase in ```mpg``` when the transmission is ```Manual```. We can also see a clear difference in the mean mpg for each transmission type.
```{r}
aggregate(mpg ~ am, data = cars, mean)
```

However, there are other variables that could also impact mpg and they should also be considered. Plotting the data with a pairs plot, figure 1 in appendix, we see that the variables `cyl`, `disp`, `hp`, `wt`, `drat`, and `am` seem to have a strong correlation with `mpg`.


```{r, echo=FALSE}
#cor(mtcars[,1],mtcars[,-1])
```

## Regression Analysis

In this section we start building a linear model based on different variables. We first build a simple model with only `am` as the predictor. 
```{r}
lm1 <- lm(mpg ~ am, data=cars)
summary(lm1)$coef; summary(lm1)$adj.r.squared;
```

Based on this simple model it appears the transmission type is significant with a p-value < .05. However, the adjusted $R^2$ implies the model only explains about 36% of the variation.

We can do better. We will build a model based on all the predictors, then perform stepwise selection to select significant figures for the final model.
```{r}
lm2 <- lm(mpg ~ ., data=cars)
summary(lm2)$coef[,4]; summary(lm2)$adj.r.squared;
```
From this we can see there are variables with p-values > .05. Instead of removing variables manually we will use the step function to perform a forward and backwards stepwise selection.
```{r}
slm2 <- step(lm2, direction="both")
summary(slm2)$coef; summary(slm2)$adj.r.square
```


```{r, echo=FALSE}
#cor(mtcars$mpg, mtcars)
#lm.am <- lm(mpg ~ am, data=mtcars)
#lm.am.cyl <- lm(mpg ~ am + cyl, data=mtcars)
#lm.cyl <- lm(mpg ~ cyl, data=mtcars)
#lm.cyl.am <- lm(mpg ~ cyl + am, data=mtcars)
#lm1 <- lm(mpg ~ ., data=mtcars)
#summary(lm1)
#slm1 <- step(lm1)
#summary(slm1)

#lm.am.wt <- lm(mpg ~ am + wt, data=mtcars) # r=73.58
#lm.am.cyl <- lm(mpg ~ am + cyl, data=mtcars) # r=74.24
#lm.am.hp <- lm(mpg ~ am + hp, data=mtcars)  # r=76.7 * but small coef
#lm.am.qsec <- lm(mpg ~ am + qsec, data=mtcars) # r=66.52 *
#lm.am.vs <- lm(mpg ~ am + vs, data=mtcars) # r=66.56 *  + big coef
#lm.am.carb <- lm(mpg ~ am + carb, data=mtcars) # r=68.3 *  + good coef
#lm.am.vs.carb <- lm(mpg ~ am + vs + carb, data=mtcars) # r=75.8 ok coef
#lm.am.vs.carb.2 <- lm(mpg ~ am + vs + carb, data=mtcars) # r=75.8 ok coef

# best models - seem equal
#lm.wt.qsec.am.mult <- lm(mpg ~ wt + qsec + am + am*wt, data=mtcars)
#summary(lm.wt.qsec.am.mult)
#lm5 <- lm(mpg ~ wt + qsec + wt*am, data=cars)
#lm.qsec.amwt <- lm(mpg ~ qsec + wt*am, data=mtcars)

#lm.wt.hp <- lm(mpg ~ wt + wt*hp, data=mtcars)   # very close

#lm.b1 <- lm(mpg ~ cyl*disp - 1, data=mtcars)
#lm.b2 <- lm(formula = mpg ~ am + cyl * disp - 1, data = mtcars)

# Plot residuals
#plot(predict(slm1), resid(slm1))

# or
#par(mfrow=c(2,2))
#plot(slm1)
#par(mfrow=c(1,1))
```

## Residuals and Diagnostics

## Conclusion

### Inference and/or Quantified Uncertainty


Appendix
-----------------------
### **Figure 1:** Boxplot of mpg and transmission
```{r, echo=FALSE}
boxplot(mpg ~ am, data=cars, xlab="Transmission", ylab="MPG")
```

### **Figure 2:** Pairs plot of mtcars variables
```{r, echo=FALSE}
## put (absolute) correlations on the panel,
## with size proportional to the correlations.
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(mtcars, upper.panel=panel.smooth, lower.panel=panel.cor, col=3 + (mtcars$am == 0))
```


When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. 
